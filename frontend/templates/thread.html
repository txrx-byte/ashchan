<!--
  Copyright 2026 txrx-byte

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

{% extends "layout.html" %}

{% block content %}

<!-- Post Form (Thread Reply) -->
<div id="postForm">
  <form id="mpostform" name="post" action="/api/v1/boards/{{ board_slug }}/threads/{{ thread_id }}/posts" method="post" enctype="multipart/form-data">
    <table class="postForm replyMode">
      <tbody>
        <tr data-type="Name">
          <td class="label">Name</td>
          <td><input name="name" type="text" placeholder="Anonymous" autocomplete="off" maxlength="75"></td>
        </tr>
        <tr data-type="Options">
          <td class="label">Options</td>
          <td><input name="email" type="text" placeholder="sage" autocomplete="off" maxlength="75"></td>
        </tr>
        <tr data-type="Comment">
          <td class="label">Comment</td>
          <td><textarea name="com" cols="48" rows="4" maxlength="2000" wrap="soft"></textarea></td>
        </tr>
        <tr data-type="File">
          <td class="label">File</td>
          <td>
            <input name="upfile" type="file" accept="image/jpeg,image/png,image/gif,image/webp">
            <label><input type="checkbox" name="spoiler"> Spoiler?</label>
          </td>
        </tr>
        <tr id="captchaRow" data-type="Captcha">
          <td class="label">Captcha</td>
          <td>
            <div id="t-root">
              <img id="captchaImg" src="/api/v1/captcha" alt="captcha" style="cursor:pointer" title="Click to refresh">
              <input name="captcha_response" type="text" placeholder="Type the text above" maxlength="8" autocomplete="off">
            </div>
          </td>
        </tr>
        <tr>
          <td></td>
          <td><input type="submit" value="Post"></td>
        </tr>
      </tbody>
    </table>
  </form>
</div>
<div id="postFormError"></div>

<hr>

<!-- Thread Controls -->
<div class="thread-controls">
  <span id="ctrl-top">
    [<a href="/{{ board_slug }}/">Return</a>]
    [<a href="/{{ board_slug }}/catalog">Catalog</a>]
    [<a href="#bottom">Bottom</a>]
    [<a href="#" class="watchThread">Watch Thread</a>]
  </span>
</div>

<hr>

<!-- Thread Container -->
<form id="delform" name="delform" class="deleteform">
  <div class="thread" id="t{{ thread_id }}">

    <!-- OP Post -->
    <div class="postContainer opContainer" id="pc{{ op.id }}">
      <div id="p{{ op.id }}" class="post op">
        <div class="postInfoM mobile" id="pim{{ op.id }}">
          <span class="nameBlock">
            <span class="name">{{ op.author_name|default('Anonymous') }}</span>
            {% if op.tripcode %}<span class="postertrip">{{ op.tripcode }}</span>{% endif %}
          </span><br>
          <span class="dateTime" data-utc="{{ op.created_at }}">{{ op.formatted_time }}</span>
          <span class="postNum mobile">
            <a href="#p{{ op.id }}">No.</a>
            <a href="#q{{ op.id }}">{{ op.id }}</a>
          </span>
        </div>
        <div class="postInfo desktop" id="pi{{ op.id }}">
          <input type="checkbox" name="{{ op.id }}" value="delete">
          {% if op.subject %}<span class="subject">{{ op.subject }}</span>{% endif %}
          <span class="nameBlock">
            <span class="name">{{ op.author_name|default('Anonymous') }}</span>
            {% if op.tripcode %}<span class="postertrip">{{ op.tripcode }}</span>{% endif %}
            {% if op.capcode %}<span class="capcode">## {{ op.capcode }}</span>{% endif %}
          </span>
          <span class="dateTime" data-utc="{{ op.created_at }}">{{ op.formatted_time }}</span>
          <span class="postNum desktop">
            <a href="#p{{ op.id }}" title="Link to this post">No.</a>
            <a href="#q{{ op.id }}" title="Reply to this post">{{ op.id }}</a>
          </span>
          <span class="postMenuBtn" title="Post menu">▶</span>
          {% if op.backlinks %}
          <span class="backlink">
            {% for bl in op.backlinks %}
              <a href="#p{{ bl }}" class="quotelink">&gt;&gt;{{ bl }}</a>
            {% endfor %}
          </span>
          {% endif %}
        </div>

        {% if op.media_url %}
        <div class="file" id="f{{ op.id }}">
          <div class="fileText" id="fT{{ op.id }}">
            File: <a href="{{ op.media_url }}" target="_blank">{{ op.media_filename }}</a>
            ({{ op.media_size_human }}, {{ op.media_dimensions }})
          </div>
          <a class="fileThumb" href="{{ op.media_url }}" target="_blank">
            <img src="{{ op.thumb_url }}" alt="{{ op.media_size_human }}" loading="lazy"
                 style="max-width:250px;max-height:250px;">
          </a>
        </div>
        {% endif %}

        <blockquote class="postMessage" id="m{{ op.id }}">
          {{ op.content_html|safe }}
        </blockquote>
      </div>
    </div>

    <!-- Replies -->
    {% for reply in replies %}
    <div class="postContainer replyContainer" id="pc{{ reply.id }}">
      <div class="sideArrows" id="sa{{ reply.id }}">&gt;&gt;</div>
      <div id="p{{ reply.id }}" class="post reply">
        <div class="postInfoM mobile" id="pim{{ reply.id }}">
          <span class="nameBlock">
            <span class="name">{{ reply.author_name|default('Anonymous') }}</span>
            {% if reply.tripcode %}<span class="postertrip">{{ reply.tripcode }}</span>{% endif %}
          </span><br>
          <span class="dateTime" data-utc="{{ reply.created_at }}">{{ reply.formatted_time }}</span>
          <span class="postNum mobile">
            <a href="#p{{ reply.id }}">No.</a>
            <a href="#q{{ reply.id }}">{{ reply.id }}</a>
          </span>
        </div>
        <div class="postInfo desktop" id="pi{{ reply.id }}">
          <input type="checkbox" name="{{ reply.id }}" value="delete">
          <span class="nameBlock">
            <span class="name">{{ reply.author_name|default('Anonymous') }}</span>
            {% if reply.tripcode %}<span class="postertrip">{{ reply.tripcode }}</span>{% endif %}
            {% if reply.capcode %}<span class="capcode">## {{ reply.capcode }}</span>{% endif %}
          </span>
          <span class="dateTime" data-utc="{{ reply.created_at }}">{{ reply.formatted_time }}</span>
          <span class="postNum desktop">
            <a href="#p{{ reply.id }}" title="Link to this post">No.</a>
            <a href="#q{{ reply.id }}" title="Reply to this post">{{ reply.id }}</a>
          </span>
          <span class="postMenuBtn" title="Post menu">▶</span>
          {% if reply.backlinks %}
          <span class="backlink">
            {% for bl in reply.backlinks %}
              <a href="#p{{ bl }}" class="quotelink">&gt;&gt;{{ bl }}</a>
            {% endfor %}
          </span>
          {% endif %}
        </div>

        {% if reply.media_url %}
        <div class="file" id="f{{ reply.id }}">
          <div class="fileText" id="fT{{ reply.id }}">
            File: <a href="{{ reply.media_url }}" target="_blank">{{ reply.media_filename }}</a>
            ({{ reply.media_size_human }})
          </div>
          <a class="fileThumb" href="{{ reply.media_url }}" target="_blank">
            <img src="{{ reply.thumb_url }}" alt="{{ reply.media_size_human }}" loading="lazy"
                 style="max-width:125px;max-height:125px;">
          </a>
        </div>
        {% endif %}

        <blockquote class="postMessage" id="m{{ reply.id }}">
          {{ reply.content_html|safe }}
        </blockquote>
      </div>
    </div>
    {% endfor %}

  </div>

  <!-- Delete / Report Controls -->
  <div class="deleteform-controls" id="ctrl-bottom">
    <span class="deleteBtn">
      Delete Post
      [<label><input type="checkbox" name="onlyimgdel"> File Only</label>]
      Password <input type="password" name="pwd" id="delPassword" maxlength="8" size="8">
      <input type="submit" value="Delete">
    </span>
    [<input type="button" value="Report" onclick="alert('Select a post first')">]
  </div>
</form>

<hr>

<!-- Thread Stats + Auto-Update -->
<div class="thread-stats">
  <span class="ts-replies">{{ replies|length }} replies</span>
  <span class="ts-images">{{ image_count }} images</span>
  {% if thread_locked %}<span class="ts-locked">[Locked]</span>{% endif %}
  {% if thread_sticky %}<span class="ts-sticky">[Sticky]</span>{% endif %}
</div>

<div id="autoUpdateCtrl" class="auto-update-ctrl">
  <label>
    <input type="checkbox" checked> Auto
  </label>
  <span id="autoUpdateStatus"></span>
  [<a href="#" id="updateNow">Update</a>]
</div>

<hr>

<!-- Bottom Controls -->
<div class="thread-controls">
  <span>
    [<a href="/{{ board_slug }}/">Return</a>]
    [<a href="/{{ board_slug }}/catalog">Catalog</a>]
    [<a href="#top">Top</a>]
  </span>
</div>

<a id="bottom"></a>

{% endblock %}
