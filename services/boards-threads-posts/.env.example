# Ashchan Boards/Threads/Posts Service Configuration
# mTLS ServiceMesh Environment

# ─────────────────────────────────────────────────────────────
# Service Identity
# ─────────────────────────────────────────────────────────────
APP_NAME=boards-threads-posts
APP_ENV=local
SERVICE_NAME=boards
SERVICE_DNS_NAME=boards.ashchan.local

# ─────────────────────────────────────────────────────────────
# Server Configuration
# ─────────────────────────────────────────────────────────────
# HTTP port (development only)
HTTP_PORT=9503

# Internal mTLS port (service-to-service)
MTLS_PORT=8445

# ─────────────────────────────────────────────────────────────
# mTLS Configuration (Service-to-Service)
# ─────────────────────────────────────────────────────────────
MTLS_ENABLED=true
MTLS_CERT_FILE=__PROJECT_ROOT__/certs/services/boards/boards.crt
MTLS_KEY_FILE=__PROJECT_ROOT__/certs/services/boards/boards.key
MTLS_CA_FILE=__PROJECT_ROOT__/certs/ca/ca.crt
MTLS_VERIFY_PEER=true
MTLS_MIN_TLS_VERSION=TLSv1.3

# Client certificates for outbound calls
MTLS_CLIENT_CERT_FILE=__PROJECT_ROOT__/certs/services/boards/boards.crt
MTLS_CLIENT_KEY_FILE=__PROJECT_ROOT__/certs/services/boards/boards.key

# ─────────────────────────────────────────────────────────────
# Database (PostgreSQL)
# ─────────────────────────────────────────────────────────────
DB_DRIVER=pgsql
DB_HOST=__DB_HOST__
DB_PORT=5432
DB_DATABASE=ashchan
DB_USERNAME=ashchan
DB_PASSWORD=ashchan
DB_CHARSET=utf8
DB_POOL_SIZE=10

# ─────────────────────────────────────────────────────────────
# Redis (Cache, Queue, Pub/Sub)
# ─────────────────────────────────────────────────────────────
REDIS_HOST=__REDIS_HOST__
REDIS_PORT=6379
REDIS_PASSWORD=__REDIS_PASSWORD__
REDIS_AUTH=__REDIS_AUTH__
REDIS_DB=2
REDIS_POOL_SIZE=10

# ─────────────────────────────────────────────────────────────
# Media Service URL (mTLS)
# ─────────────────────────────────────────────────────────────
MEDIA_SERVICE_URL=https://media.ashchan.local:8443

# ─────────────────────────────────────────────────────────────
# Moderation Service URL (mTLS)
# ─────────────────────────────────────────────────────────────
MODERATION_SERVICE_URL=https://moderation.ashchan.local:8443

# ─────────────────────────────────────────────────────────────
# Board Configuration
# ─────────────────────────────────────────────────────────────
MAX_THREADS_PER_PAGE=10
MAX_POSTS_PER_THREAD=1000
MAX_POST_LENGTH=4096
ALLOWED_FILE_EXTENSIONS=jpg,jpeg,png,gif,webp,mp4,webm

# ─────────────────────────────────────────────────────────────
# Caching
# ─────────────────────────────────────────────────────────────
CACHE_TTL_THREADS=300
CACHE_TTL_BOARDS=600
CACHE_TTL_CATALOG=120

# ─────────────────────────────────────────────────────────────
# Logging
# ─────────────────────────────────────────────────────────────
LOG_LEVEL=info
LOG_FORMAT=json

# ─────────────────────────────────────────────────────────────
# PII Encryption at Rest
# ─────────────────────────────────────────────────────────────
# Key for encrypting PII (IP addresses, emails) at rest.
# Generate with: php -r "echo sodium_bin2hex(random_bytes(32));" 
# REQUIRED in production. If empty, PII is stored in plaintext.
PII_ENCRYPTION_KEY=

# Salt for generating consistent poster ID hashes (for staff 'Same Poster' feature)
IP_HASH_SALT=ashchan_secret_salt
