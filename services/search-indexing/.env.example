# Ashchan Search/Indexing Service Configuration
# mTLS ServiceMesh Environment

# ─────────────────────────────────────────────────────────────
# Service Identity
# ─────────────────────────────────────────────────────────────
APP_NAME=search-indexing
APP_ENV=local
SERVICE_NAME=search
SERVICE_DNS_NAME=search.ashchan.local

# ─────────────────────────────────────────────────────────────
# Server Configuration
# ─────────────────────────────────────────────────────────────
# HTTP port (development only)
HTTP_PORT=9505

# Internal mTLS port (service-to-service)
MTLS_PORT=8447

# ─────────────────────────────────────────────────────────────
# mTLS Configuration (Service-to-Service)
# ─────────────────────────────────────────────────────────────
MTLS_ENABLED=true
MTLS_CERT_FILE=__PROJECT_ROOT__/certs/services/search/search.crt
MTLS_KEY_FILE=__PROJECT_ROOT__/certs/services/search/search.key
MTLS_CA_FILE=__PROJECT_ROOT__/certs/ca/ca.crt
MTLS_VERIFY_PEER=true
MTLS_MIN_TLS_VERSION=TLSv1.3

# Client certificates for outbound calls
MTLS_CLIENT_CERT_FILE=__PROJECT_ROOT__/certs/services/search/search.crt
MTLS_CLIENT_KEY_FILE=__PROJECT_ROOT__/certs/services/search/search.key

# ─────────────────────────────────────────────────────────────
# Database (PostgreSQL)
# ─────────────────────────────────────────────────────────────
DB_DRIVER=pgsql
DB_HOST=__DB_HOST__
DB_PORT=5432
DB_DATABASE=ashchan
DB_USERNAME=ashchan
DB_PASSWORD=ashchan
DB_CHARSET=utf8
DB_POOL_SIZE=10

# ─────────────────────────────────────────────────────────────
# Redis (Cache, Queue)
# ─────────────────────────────────────────────────────────────
REDIS_HOST=__REDIS_HOST__
REDIS_PORT=6379
REDIS_PASSWORD=__REDIS_PASSWORD__
REDIS_AUTH=__REDIS_AUTH__
REDIS_DB=4
REDIS_POOL_SIZE=10

# ─────────────────────────────────────────────────────────────
# Search Backend Configuration
# ─────────────────────────────────────────────────────────────
# Options: database (PostgreSQL full-text), elasticsearch, meilisearch
SEARCH_BACKEND=database

# PostgreSQL Full-Text Search Configuration
SEARCH_MIN_WORD_LENGTH=3
SEARCH_MAX_RESULTS=100
SEARCH_RANK_THRESHOLD=0.1

# Elasticsearch Configuration (optional)
ELASTICSEARCH_HOST=localhost
ELASTICSEARCH_PORT=9200
ELASTICSEARCH_INDEX=ashchan-posts

# ─────────────────────────────────────────────────────────────
# Event Consumer Configuration
# ─────────────────────────────────────────────────────────────
# Consumes domain events from Redis streams
EVENTS_STREAM_NAME=ashchan-events
EVENTS_CONSUMER_GROUP=search-indexing
EVENTS_BATCH_SIZE=100
EVENTS_POLL_INTERVAL=1000

# ─────────────────────────────────────────────────────────────
# Indexing Configuration
# ─────────────────────────────────────────────────────────────
INDEX_BATCH_SIZE=50
INDEX_FLUSH_INTERVAL=5000

# ─────────────────────────────────────────────────────────────
# Logging
# ─────────────────────────────────────────────────────────────
LOG_LEVEL=info
LOG_FORMAT=json
