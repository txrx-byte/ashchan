<!DOCTYPE html>
<!--
  Copyright 2026 txrx-byte

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<html>
<head>
  <meta charset="utf-8">
  <meta name="referrer" content="never">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title><?= $action === 'create' ? 'Add' : 'Edit' ?> Report Category - Ashchan Staff</title>
  <link rel="stylesheet" type="text/css" href="/staff/css/admincore.css">
  <link rel="stylesheet" type="text/css" href="/staff/css/admin.css">
  <link rel="shortcut icon" href="/staff/favicon.ico" type="image/x-icon">
  <style>
    .form-grid { max-width:600px; margin:1rem auto; }
    .form-grid table { width:100%; border-collapse:collapse; }
    .form-grid th { text-align:right; padding:8px 12px 8px 0; vertical-align:top; width:160px; font-weight:600; font-size:0.9rem; color:#374151; }
    .form-grid td { padding:8px 0; }
    .form-grid input[type="text"],
    .form-grid input[type="number"],
    .form-grid select { width:100%; padding:6px 10px; border:1px solid #d1d5db; border-radius:4px; font-size:0.9rem; }
    .form-grid .note { font-size:0.8rem; color:#6b7280; margin-top:4px; }
    .form-grid .checkbox-group label { display:block; margin:4px 0; font-size:0.9rem; }
    .form-grid .checkbox-group input[type="checkbox"] { margin-right:6px; }
    .btn-submit { background:#3b82f6; color:#fff; border:none; padding:8px 24px; border-radius:4px; cursor:pointer; font-size:0.95rem; font-weight:600; }
    .btn-submit:hover { background:#2563eb; }
  </style>
</head>
<body>
<!-- Navigation Sidebar -->
<nav id="admin-nav">
  <div class="admin-logo">Ashchan Admin</div>
  <ul class="nav-section">
    <li class="nav-header">Main</li>
    <li><a href="/staff/admin">Overview</a></li>
    <li><a href="/staff/dashboard">Dashboard</a></li>
  </ul>
  <ul class="nav-section">
    <li class="nav-header">Moderation</li>
    <li><a href="/staff/reports">Reports Queue</a></li>
    <li><a href="/staff/reports/ban-requests">Ban Requests</a></li>
    <li><a href="/staff/bans">Bans</a></li>
    <li><a href="/staff/ban-templates">Ban Templates</a></li>
    <li><a href="/staff/report-categories" class="active">Report Categories</a></li>
  </ul>
  <ul class="nav-section nav-footer">
    <li><form method="POST" action="/staff/logout" style="display:inline"><button type="submit" class="logout" style="background:none;border:none;cursor:pointer;color:inherit;font:inherit;padding:0">Logout</button></form></li>
  </ul>
</nav>

<main id="admin-content">
<header class="content-header">
  <h1><?= $action === 'create' ? 'Add' : 'Edit' ?> Report Category</h1>
  <div class="header-actions">
    <a href="/staff/report-categories" class="button button-light">&larr; Back to Categories</a>
  </div>
</header>

<div class="form-grid">
<form action="/staff/report-categories<?= $action === 'edit' && $category ? '/' . $category['id'] : '' ?>" method="POST">
  <table>
    <tr>
      <th>Board</th>
      <td>
        <select name="board">
          <?php foreach ($boardList as $value => $label): ?>
          <option value="<?= htmlspecialchars((string) $value) ?>" <?= ($category['board'] ?? '') === (string) $value ? 'selected' : '' ?>><?= htmlspecialchars((string) $label) ?></option>
          <?php endforeach ?>
        </select>
      </td>
    </tr>
    <tr>
      <th>Title</th>
      <td><input type="text" name="title" value="<?= htmlspecialchars((string) ($category['title'] ?? '')) ?>" required></td>
    </tr>
    <tr>
      <th>Weight</th>
      <td>
        <input type="number" name="weight" step="0.01" min="0.01" value="<?= htmlspecialchars((string)($category['weight'] ?? '1')) ?>" required>
        <div class="note">Higher weight = higher severity priority</div>
      </td>
    </tr>
    <tr>
      <th>Exclude Boards</th>
      <td>
        <input type="text" name="exclude_boards" value="<?= htmlspecialchars((string) ($category['exclude_boards'] ?? '')) ?>" placeholder="a,b,c (comma-separated)">
        <div class="note">Comma-separated board slugs to exclude from this category</div>
      </td>
    </tr>
    <tr>
      <th>Filtered Threshold</th>
      <td>
        <input type="number" name="filtered" value="<?= htmlspecialchars((string)($category['filtered'] ?? '0')) ?>" min="0">
        <div class="note">0 = disabled, &gt;0 = auto-clear reports below this threshold</div>
      </td>
    </tr>
    <tr>
      <th>Options</th>
      <td class="checkbox-group">
        <label><input type="checkbox" name="op_only" <?= ($category['op_only'] ?? 0) ? 'checked' : '' ?>> OPs only</label>
        <label><input type="checkbox" name="reply_only" <?= ($category['reply_only'] ?? 0) ? 'checked' : '' ?>> Replies only</label>
        <label><input type="checkbox" name="image_only" <?= ($category['image_only'] ?? 0) ? 'checked' : '' ?>> Images only</label>
      </td>
    </tr>
    <tr>
      <td></td>
      <td>
        <button class="btn-submit" type="submit"><?= $action === 'create' ? 'Create Category' : 'Save Changes' ?></button>
      </td>
    </tr>
  </table>
</form>
</div>
</main>

<script src="/staff/js/admincore.js"></script>
</body>
</html>
