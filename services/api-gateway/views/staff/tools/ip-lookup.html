<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="referrer" content="never">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>IP Lookup - Ashchan Staff</title>
  <link rel="stylesheet" type="text/css" href="/staff/css/admincore.css">
  <link rel="stylesheet" type="text/css" href="/staff/css/bans.css">
  <link rel="stylesheet" type="text/css" href="/staff/css/admin.css">
  <link rel="shortcut icon" href="/staff/favicon.ico" type="image/x-icon">
</head>
<body>
<nav id="admin-nav">
  <div class="admin-logo">Ashchan Admin</div>
  <ul class="nav-section">
    <li class="nav-header">Main</li>
    <li><a href="/staff/admin">Overview</a></li>
    <li><a href="/staff/dashboard">Dashboard</a></li>
  </ul>
  <ul class="nav-section">
    <li class="nav-header">Moderation</li>
    <li><a href="/staff/reports">Reports Queue</a></li>
    <li><a href="/staff/reports/ban-requests">Ban Requests</a></li>
    <li><a href="/staff/bans">Bans</a></li>
    <li><a href="/staff/ban-templates">Ban Templates</a></li>
    <li><a href="/staff/report-categories">Report Categories</a></li>
  </ul>
  <ul class="nav-section">
    <li class="nav-header">Search & Tools</li>
    <li><a href="/staff/search">Search</a></li>
    <li><a href="/staff/ip-lookup" class="active">IP Lookup</a></li>
    <li><a href="/staff/check-md5">Check MD5</a></li>
    <li><a href="/staff/check-filter">Check Filter</a></li>
  </ul>
  <ul class="nav-section nav-footer">
    <li><a href="/staff/logout" class="logout">Logout</a></li>
  </ul>
</nav>

<main id="admin-content">
<header class="content-header">
  <h1>IP Lookup</h1>
</header>

<div class="search-form-container">
  <form method="GET" action="/staff/ip-lookup" class="search-form">
    <input type="text" name="ip" placeholder="Enter IP address (e.g., 192.168.1.1)" value="<?= htmlspecialchars($ip ?? '') ?>" class="search-input" style="max-width: 400px;">
    <button type="submit" class="button button-primary">üîç Lookup</button>
  </form>
</div>

<?php if ($info !== null): ?>
<div class="content-section">
  <h2>IP Information: <?= htmlspecialchars($ip) ?></h2>
  
  <div class="ip-summary">
    <div class="summary-item">
      <span class="summary-label">Total Bans:</span>
      <span class="summary-value <?= $info['ban_count'] > 0 ? 'text-danger' : '' ?>"><?= $info['ban_count'] ?></span>
    </div>
    <div class="summary-item">
      <span class="summary-label">Total Reports:</span>
      <span class="summary-value <?= $info['report_count'] > 0 ? 'text-warning' : '' ?>"><?= $info['report_count'] ?></span>
    </div>
  </div>
  
  <?php if (!empty($info['bans'])): ?>
  <h3 style="margin-top: 20px;">Ban History</h3>
  <table class="items-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Board</th>
        <th>Reason</th>
        <th>Banned On</th>
        <th>Length</th>
        <th>Banned By</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <?php foreach ($info['bans'] as $ban): ?>
      <tr>
        <td>#<?= $ban->id ?></td>
        <td>/<?= htmlspecialchars($ban->board ?: 'Global') ?>/</td>
        <td><?= htmlspecialchars($ban->reason ?? '') ?></td>
        <td><?= date('m/d/y H:i', strtotime($ban->now)) ?></td>
        <td><?= $ban->length ? 'Permanent' : 'Temporary' ?></td>
        <td><?= htmlspecialchars($ban->admin) ?></td>
        <td>
          <?php if ($ban->active): ?>
            <span class="badge badge-success">Active</span>
          <?php else: ?>
            <span class="badge badge-secondary">Expired</span>
          <?php endif ?>
        </td>
      </tr>
      <?php endforeach ?>
    </tbody>
  </table>
  <?php else: ?>
  <p style="margin-top: 20px; color: #666;">No bans found for this IP</p>
  <?php endif ?>
  
  <?php if (!empty($info['reports'])): ?>
  <h3 style="margin-top: 20px;">Recent Reports</h3>
  <table class="items-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Board</th>
        <th>Post No</th>
        <th>Time</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <?php foreach ($info['reports'] as $report): ?>
      <tr>
        <td>#<?= $report->id ?></td>
        <td>/<?= htmlspecialchars($report->board) ?>/</td>
        <td>No.<?= $report->no ?></td>
        <td><?= date('m/d/y H:i', strtotime($report->ts)) ?></td>
        <td>
          <?php if ($report->cleared): ?>
            <span class="badge badge-success">Cleared</span>
          <?php else: ?>
            <span class="badge badge-warning">Pending</span>
          <?php endif ?>
        </td>
      </tr>
      <?php endforeach ?>
    </tbody>
  </table>
  <?php else: ?>
  <p style="margin-top: 20px; color: #666;">No reports found for this IP</p>
  <?php endif ?>
  
</div>
<?php elseif ($ip !== ''): ?>
<div class="empty-state">
  <div class="empty-icon">‚ùå</div>
  <h2>Invalid IP Address</h2>
  <p>Please enter a valid IPv4 or IPv6 address</p>
</div>
<?php else: ?>
<div class="content-section">
  <h2>IP Lookup Tool</h2>
  <p>Enter an IP address to view:</p>
  <ul class="search-tips">
    <li>Ban history for that IP</li>
    <li>Reports submitted from that IP</li>
    <li>User actions (posts, uploads)</li>
    <li>Geolocation information (if available)</li>
  </ul>
</div>
<?php endif ?>
</main>

<style>
.ip-summary {
  display: flex;
  gap: 30px;
  margin: 20px 0;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
}
.summary-item {
  display: flex;
  gap: 10px;
  align-items: center;
}
.summary-label {
  color: #666;
  font-size: 14px;
}
.summary-value {
  font-weight: bold;
  font-size: 20px;
}
.text-danger { color: #e74c3c; }
.text-warning { color: #f39c12; }
.badge-success { background: #27ae60; }
.badge-warning { background: #f39c12; }
.badge-secondary { background: #95a5a6; }
</style>
</body>
</html>
