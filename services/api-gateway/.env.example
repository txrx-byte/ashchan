# Ashchan API Gateway Configuration
# mTLS ServiceMesh Environment

# ─────────────────────────────────────────────────────────────
# Service Identity
# ─────────────────────────────────────────────────────────────
APP_NAME=api-gateway
APP_ENV=local
SERVICE_NAME=gateway
SERVICE_DNS_NAME=gateway.ashchan.local

# ─────────────────────────────────────────────────────────────
# Server Configuration
# ─────────────────────────────────────────────────────────────
# Public HTTP port (client-facing)
HTTP_PORT=9501

# Public HTTPS port (optional, for TLS termination)
HTTPS_PORT=9443

# Internal mTLS port (service-to-service)
MTLS_PORT=8443

# ─────────────────────────────────────────────────────────────
# mTLS Configuration (Service-to-Service)
# ─────────────────────────────────────────────────────────────
MTLS_ENABLED=true
MTLS_CERT_FILE=__PROJECT_ROOT__/certs/services/gateway/gateway.crt
MTLS_KEY_FILE=__PROJECT_ROOT__/certs/services/gateway/gateway.key
MTLS_CA_FILE=__PROJECT_ROOT__/certs/ca/ca.crt
MTLS_VERIFY_PEER=true
MTLS_MIN_TLS_VERSION=TLSv1.3

# Client certificate for outbound mTLS requests to backend services
MTLS_CLIENT_CERT_FILE=__PROJECT_ROOT__/certs/services/gateway/gateway.crt
MTLS_CLIENT_KEY_FILE=__PROJECT_ROOT__/certs/services/gateway/gateway.key

# ─────────────────────────────────────────────────────────────
# Database (PostgreSQL)
# ─────────────────────────────────────────────────────────────
DB_DRIVER=pgsql
DB_HOST=__DB_HOST__
DB_PORT=5432
DB_DATABASE=ashchan
DB_USERNAME=ashchan
DB_PASSWORD=ashchan
DB_CHARSET=utf8
DB_POOL_SIZE=10

# ─────────────────────────────────────────────────────────────
# Redis (Cache, Queue, Pub/Sub)
# ─────────────────────────────────────────────────────────────
REDIS_HOST=__REDIS_HOST__
REDIS_PORT=6379
REDIS_PASSWORD=__REDIS_PASSWORD__
REDIS_AUTH=__REDIS_AUTH__
REDIS_DB=0
REDIS_POOL_SIZE=10

# ─────────────────────────────────────────────────────────────
# Backend Service URLs
# ─────────────────────────────────────────────────────────────
# Local dev uses HTTP on service ports; production uses mTLS on port 8443

AUTH_SERVICE_URL=http://localhost:9502
BOARDS_SERVICE_URL=http://localhost:9503
MEDIA_SERVICE_URL=http://localhost:9504
SEARCH_SERVICE_URL=http://localhost:9505
MODERATION_SERVICE_URL=http://localhost:9506

# ─────────────────────────────────────────────────────────────
# Object Storage (MinIO/S3)
# ─────────────────────────────────────────────────────────────
MINIO_ENDPOINT=minio.ashchan.local:9000
MINIO_ACCESS_KEY=ashchan
MINIO_SECRET_KEY=ashchan123
MINIO_BUCKET=ashchan-media
MINIO_USE_SSL=false

# ─────────────────────────────────────────────────────────────
# CORS (Public API)
# ─────────────────────────────────────────────────────────────
CORS_ORIGINS=*
CORS_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Request-ID

# ─────────────────────────────────────────────────────────────
# Rate Limiting
# ─────────────────────────────────────────────────────────────
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW=60

# ─────────────────────────────────────────────────────────────
# Logging
# ─────────────────────────────────────────────────────────────
LOG_LEVEL=info
LOG_FORMAT=json

# ─────────────────────────────────────────────────────────────
# WebSocket (Live Updates)
# ─────────────────────────────────────────────────────────────
WEBSOCKET_ENABLED=true
WEBSOCKET_PORT=9501

# ─────────────────────────────────────────────────────────────
# Event Bus (Redis Streams)
# ─────────────────────────────────────────────────────────────
# Consumer: cache-invalidation group; also hosts CLI tools
EVENTS_STREAM_NAME=ashchan:events
EVENTS_DLQ_STREAM=ashchan:events:dlq
EVENTS_MAXLEN=100000
EVENTS_REDIS_DB=6
EVENTS_CONSUMER_GROUP=cache-invalidation
EVENTS_BATCH_SIZE=100
EVENTS_POLL_INTERVAL=1000
EVENTS_MAX_RETRIES=3

# ─────────────────────────────────────────────────────────────
# Varnish Cache (HTTP Accelerator)
# ─────────────────────────────────────────────────────────────
# CacheInvalidatorProcess sends HTTP BAN requests to this URL
# when domain events fire. Set to empty string to disable.
VARNISH_URL=http://127.0.0.1:6081
